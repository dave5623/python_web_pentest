import re
import time
import urllib2
from random import randint

regex = re.compile((
                   "([a-z0-9!#$%&'*+\/=?^_'{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_'""{|}~-]+)*(@|\sat\s)(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?(\.|""\sdot\s))+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)"))

tarurl = open('urls.txt', 'r')

for line in tarurl:
    output = open("emails.txt", 'a')
    time.sleep(randint(10, 100))
    try:
        url = urllib2.urlopen(line).read()
        output.write(line)
        emails = re.findall(regex, url)
        for email in emails:
            output.write(email[0] + "\r\n")
            print email[0]
    except:
        pass
        print "error"

    output.close()

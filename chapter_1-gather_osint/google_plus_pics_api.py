import ConfigParser
import json
import os
import urllib2

config = ConfigParser.ConfigParser()
config.read('../lib/properties.prop')
GOOGLE_API_KEY = config.get('chapter1', 'google_api')

target = "packtpub.com"
api_response = urllib2.urlopen(
    "https://www.googleapis.com/plus/v1/people?query=" + target + "&key=" + GOOGLE_API_KEY).read()

json_response = json.loads(api_response)
for result in json_response['items']:
    name = result['displayName']
    print name
    image = result['image']['url'].split('?')[0]

    img_dir = 'img'
    if not os.path.exists(img_dir):
        os.makedirs(img_dir)

    f = open(img_dir + os.path.sep + name + '.jpg', 'wb+')
    f.write(urllib2.urlopen(image).read())
    f.close()
